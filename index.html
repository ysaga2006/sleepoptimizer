<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>睡眠スケジュール最適化</title>
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }

    h1 {
      font-size: 1.5em;
      margin-bottom: 10px;
      text-align: center;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input[type="time"],
    input[type="number"],
    input[type="date"],
    button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      background-color: #1e1e1e;
      color: #e0e0e0;
      border: 1px solid #333;
      border-radius: 5px;
    }

    button {
      margin-top: 20px;
      background-color: #333;
      cursor: pointer;
    }

    #result {
      margin-top: 20px;
      padding: 10px;
      background-color: #1e1e1e;
      border-radius: 5px;
    }

    @media (max-width: 600px) {
      input, button {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>睡眠スケジュール最適化</h1>

  <form id="sleepForm">
    <div id="sleepData">
      <p>過去1週間の睡眠記録（任意）:</p>
      <div id="sleepInputs"></div>
    </div>

    <label>予定の起床日時（何日後に何時に起きたいか）:</label>
    <input type="date" id="targetDate" />
    <input type="time" id="targetTime" />

    <label>欲しい睡眠時間（時間）:</label>
    <input type="number" id="desiredSleep" min="1" max="12" step="0.5" />

    <button type="button" onclick="calculateSchedule()">スケジュールを計算</button>
  </form>

  <div id="result"></div>

  <script>
    const sleepInputs = document.getElementById("sleepInputs");
    const days = ["月", "火", "水", "木", "金", "土", "日"];

    // 入力欄を動的に生成（空白でもOK）
    days.forEach((day, i) => {
      const sleepHTML = `
        <label>${day}曜日</label>
        <input type="time" id="bed${i}" placeholder="就寝時刻">
        <input type="time" id="wake${i}" placeholder="起床時刻">
      `;
      sleepInputs.innerHTML += sleepHTML;
    });

    function timeToHours(t) {
      if (!t) return null;
      const [h, m] = t.split(":").map(Number);
      return h + m / 60;
    }

    function hoursToTime(h) {
      const hour = Math.floor(h) % 24;
      const minute = Math.round((h % 1) * 60);
      return `${hour.toString().padStart(2, "0")}:${minute.toString().padStart(2, "0")}`;
    }

    function calculateSchedule() {
      const sleepTimes = [];

      for (let i = 0; i < 7; i++) {
        const bed = timeToHours(document.getElementById(`bed${i}`).value);
        const wake = timeToHours(document.getElementById(`wake${i}`).value);
        if (bed !== null && wake !== null) {
          const duration = wake > bed ? wake - bed : 24 - bed + wake;
          sleepTimes.push({ bed, wake, duration });
        }
      }

      const avgSleep = sleepTimes.length
        ? sleepTimes.reduce((sum, d) => sum + d.duration, 0) / sleepTimes.length
        : 7;

      const desiredSleep = parseFloat(document.getElementById("desiredSleep").value) || avgSleep;

      const date = new Date(document.getElementById("targetDate").value);
      const [h, m] = (document.getElementById("targetTime").value || "07:00").split(":").map(Number);
      date.setHours(h, m, 0, 0);

      const today = new Date();
      const daysLeft = Math.floor((date - today) / (1000 * 60 * 60 * 24));
      const output = [];

      let nextWakeTime = h + m / 60;

      for (let d = daysLeft; d >= 1; d--) {
        const bedTime = nextWakeTime - desiredSleep;
        const corrected = bedTime < 0 ? 24 + bedTime : bedTime;
        const day = new Date(today);
        day.setDate(today.getDate() + d - 1);

        output.unshift({
          date: day.toDateString(),
          bed: hoursToTime(corrected),
          wake: hoursToTime(nextWakeTime),
        });

        nextWakeTime = corrected;
      }

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "<h3>おすすめスケジュール:</h3>";
      output.forEach((d) => {
        resultDiv.innerHTML += `<p>${d.date}：${d.bed} 就寝 → ${d.wake} 起床</p>`;
      });
    }
  </script>
</body>
</html>
